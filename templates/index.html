<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Compras</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
/* Reset b√°sico */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Segoe UI", Arial, sans-serif;
}

/* Fundo branco com detalhes em amarelo */
body {
    background-color: #ffffff;
    color: #333;
}

/* Barra de navega√ß√£o */
.navbar {
    background-color: #ffcc00; /* amarelo Mercado Livre */
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.logo {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
}

.nav-links {
    list-style: none;
    display: flex;
    gap: 20px;
}

.nav-links a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: #000;
}

/* Formul√°rio */
.form-section {
    margin: 30px auto;
    text-align: center;
}

.add-form input {
    padding: 10px;
    width: 250px;
    border: 2px solid #ffcc00;
    border-radius: 5px;
    margin-right: 10px;
}

.add-form button {
    padding: 10px 20px;
    background-color: #ffcc00;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}

.add-form button:hover {
    background-color: #ffd633;
}

/* Cards dos carrinhos */
.carts-section {
    padding: 20px 40px;
}

.carts-section h2 {
    margin-bottom: 20px;
    color: #333;
}

.carts-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
}

.cart-card {
    background-color: #fffbea;
    border: 1px solid #ffcc00;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.cart-card:hover {
    transform: translateY(-5px);
}

.cart-icon {
    width: 60px;
    margin-bottom: 10px;
}

.cart-card h3 {
    margin-bottom: 15px;
    color: #333;
}

/* Bot√µes */
.btn {
    display: inline-block;
    margin: 5px;
    padding: 8px 12px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;
    background-color: #ffcc00;
    color: #333;
    transition: background 0.3s;
}

.btn:hover {
    background-color: #ffd633;
}

.btn.edit {
    background-color: #ffe066;
}

.btn.delete {
    background-color: #ff9999;
    color: #fff;
}

.btn.delete:hover {
    background-color: #ff6666;
}

/* Bolinha de status */
.status-dot {
    display: inline-block;
    width: 12px;
    height: 12px;
    margin-left: 8px;
    border-radius: 50%;
    background-color: #ccc; /* cinza quando n√£o selecionado */
    vertical-align: middle;
}

.status-dot.active {
    background-color: #ffcc00; /* amarelo Mercado Livre */
}

/* Container dos quadrinhos flutuantes */
#manage-container {
    position: fixed;
    right: 20px;
    top: 100px;
    display: flex;
    flex-direction: column;
    gap: 20px; /* espa√ßamento elegante entre quadrinhos */
    z-index: 1000;
}

/* Quadrinho flutuante de gerenciar carrinho */
.manage-cart {
    width: 320px;
    background-color: #fffbea;
    border: 1px solid #ffcc00;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    animation: fadeIn 0.3s ease-in-out;
}

.manage-cart h2 {
    margin-bottom: 12px;
    font-size: 1.1rem;
    color: #333;
}

/* Formul√°rios compactos dentro do quadrinho */
.add-form.compact {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.add-form.compact input,
.add-form.compact textarea {
    flex: 1;
    padding: 8px;
    border: 1px solid #ffcc00;
    border-radius: 5px;
}

.add-form.compact button {
    padding: 8px 15px;
    background-color: #ffcc00;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
}

.add-form.compact button:hover {
    background-color: #ffd633;
}

/* Anima√ß√£o suave para quadrinhos */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
/* Popup de aviso */
.popup-warning {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #ffcc00;
    color: #333;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    z-index: 2000;
    animation: fadeIn 0.3s ease-in-out;
}

/* Popup de confirma√ß√£o */
.popup-confirm {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fffbea;
    border: 2px solid #ffcc00;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    z-index: 2000;
    width: 300px;
    text-align: center;
}

.popup-confirm p {
    margin-bottom: 15px;
    font-weight: bold;
    color: #333;
}

.popup-confirm .actions {
    display: flex;
    justify-content: space-around;
    margin-top: 15px;
}

.popup-confirm button {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
}

.popup-confirm button:first-child {
    background-color: #ffcc00;
    color: #333;
}

.popup-confirm button:last-child {
    background-color: #ff9999;
    color: #fff;
}
</style>
</head>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Compras</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Compras</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<script>
// Conjunto de carrinhos selecionados
let selectedCarts = new Set();

// Selecionar / desselecionar carrinho
function toggleSelect(cartId, cartName) {
    const card = document.getElementById(`cart-${cartId}`);
    const dot = document.getElementById(`dot-${cartId}`);
    const manageContainer = document.getElementById("manage-container");

    if (selectedCarts.has(cartId)) {
        // desseleciona
        selectedCarts.delete(cartId);
        card.classList.remove('selected');
        dot.classList.remove('active');
        const box = document.getElementById(`manage-${cartId}`);
        if (box) box.remove();
    } else {
        // seleciona
        selectedCarts.add(cartId);
        card.classList.add('selected');
        dot.classList.add('active');

        // cria quadrinho flutuante
        const box = document.createElement("div");
        box.className = "manage-cart";
        box.id = `manage-${cartId}`;
        box.innerHTML = `
            <h2>Gerenciar Carrinho: ${cartName}</h2>
            <form action="/add_to_cart/${cartId}" method="post" class="add-form compact">
                <input type="text" name="name" placeholder="Nome do item" required>
                <button type="submit">Adicionar</button>
            </form>
            <form action="/add_bulk/${cartId}" method="post" class="add-form compact">
                <textarea name="items" placeholder="Itens separados por v√≠rgula"></textarea>
                <button type="submit">Adicionar Todos</button>
            </form>
            <div class="actions">
                <button class="btn delete" onclick="finalizeSelection(${cartId})">Finalizar</button>
            </div>
        `;
        manageContainer.appendChild(box);
    }
}

// Mostrar / esconder itens do carrinho
function toggleView(cartId) {
    const itemsDiv = document.getElementById(`items-${cartId}`);
    itemsDiv.style.display = itemsDiv.style.display === 'none' ? 'block' : 'none';
}

// Finalizar carrinho (remove quadrinho e desseleciona)
function finalizeSelection(cartId) {
    selectedCarts.delete(cartId);
    document.getElementById(`cart-${cartId}`).classList.remove('selected');
    document.getElementById(`dot-${cartId}`).classList.remove('active');
    const box = document.getElementById(`manage-${cartId}`);
    if (box) box.remove();
}

// Popup de aviso
function showPopup(message) {
    const popup = document.createElement("div");
    popup.className = "popup-warning";
    popup.innerText = message;
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 3000);
}

// A√ß√µes da navbar
function handleNavAction(action) {
    if (selectedCarts.size === 0) {
        showPopup("‚ö†Ô∏è Selecione um carrinho antes de realizar esta a√ß√£o!");
        return;
    }

    const cartId = Array.from(selectedCarts)[0]; // pega o primeiro selecionado

    if (action === "view") {
        window.location.href = "/cart/" + cartId;
    } else if (action === "edit") {
        window.location.href = "/edit/" + cartId;
    } else if (action === "delete") {
        const skipConfirm = localStorage.getItem("skipDeleteConfirm");
        if (skipConfirm === "true") {
            confirmDelete(cartId); // ‚úÖ agora chama a fun√ß√£o que faz POST
            return;
        }

        const confirmBox = document.createElement("div");
        confirmBox.className = "popup-confirm";
        confirmBox.innerHTML = `
            <p>Tem certeza que deseja deletar este carrinho?</p>
            <label><input type="checkbox" id="skipConfirm"> N√£o mostrar este aviso novamente</label>
            <div class="actions">
                <button onclick="confirmDelete(${cartId})">Sim</button>
                <button onclick="cancelDelete(this)">Cancelar</button>
            </div>
        `;
        document.body.appendChild(confirmBox);
    }
}

// Confirmar exclus√£o (POST real para backend)
function confirmDelete(cartId) {
    const skip = document.getElementById("skipConfirm")?.checked;
    if (skip) localStorage.setItem("skipDeleteConfirm", "true");

    fetch(`/delete/${cartId}`, {
        method: "POST"
    })
    .then(response => {
        if (response.ok) {
            showPopup(`üóëÔ∏è Carrinho ${cartId} deletado com sucesso!`);
            finalizeSelection(cartId);
        } else {
            showPopup("‚ùå Erro ao deletar carrinho.");
        }
    })
    .catch(() => showPopup("‚ùå Erro de conex√£o com o servidor."));

    cancelDelete(document.querySelector(".popup-confirm .actions button:last-child"));
}

// Cancelar exclus√£o
function cancelDelete(el) {
    el.closest(".popup-confirm").remove();
}

// exp√µe fun√ß√µes no escopo global (garante que onclick funcione)
window.toggleSelect = toggleSelect;
window.toggleView = toggleView;
window.finalizeSelection = finalizeSelection;
window.handleNavAction = handleNavAction;
</script>

<body>
    <!-- Barra de navega√ß√£o -->
    <nav class="navbar">
        <h1 class="logo">üõí Lista de Compras</h1>
        <ul class="nav-links">
            <li><a href="#" onclick="handleNavAction('delete')">Deletar Carrinho</a></li>
        </ul>
    </nav>

    <!-- Criar novo carrinho -->
    <section class="form-section">
        <h2>Criar Novo Carrinho</h2>
        <form action="create_cart" method="post" class="add-form">
            <input type="text" name="cart_name" placeholder="Nome do carrinho" required>
            <button type="submit">Criar Carrinho</button>
        </form>
    </section>

    <!-- Sele√ß√£o de carrinho -->
    <div class="carts-container">
        {% for cart in carts %}
        <div class="cart-card" id="cart-{{ cart.id }}">
            <img src="{{ url_for('static', filename='cart.png') }}" alt="Carrinho" class="cart-icon">
            <h3>
                {{ cart.name }}
                <span class="status-dot" id="dot-{{ cart.id }}"></span>
            </h3>

            <div class="card-actions">
                <button class="btn" onclick="toggleSelect({{ cart.id }}, '{{ cart.name }}')">Selecionar</button>
                <button class="btn edit" onclick="toggleView({{ cart.id }})">Ver Itens</button>
            </div>

            <div class="cart-items" id="items-{{ cart.id }}" style="display: none;">
                <ul>
                    {% for item in cart.items %}
                    <li>{{ item.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Container para quadrinhos flutuantes -->
    <div id="manage-container"></div>

    <!-- Script -->
    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
</body>
</html>

