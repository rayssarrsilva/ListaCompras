{% extends "base.html" %}

{% block content %}

    <!-- Criar novo carrinho -->
    <section class="form-section">
        <h2>Criar Novo Carrinho</h2>
        <form action="{{ url_for('create_cart') }}" method="post" class="add-form">
            <input type="text" name="cart_name" placeholder="Nome do carrinho" required>
            <button type="submit">Criar Carrinho</button>
        </form>
    </section>

    <!-- Seleção de carrinho -->
    <div class="carts-container">
        {% for cart in carts %}
        <div class="cart-card" id="cart-{{ cart.id }}">
            <img src="{{ url_for('static', filename='cart.png') }}" alt="Carrinho" class="cart-icon">
            <h3>
                {{ cart.name }}
                <span class="status-dot" id="dot-{{ cart.id }}"></span>
            </h3>

            <div class="card-actions">
                <button class="btn" onclick="toggleSelect({{ cart.id }}, '{{ cart.name|e }}')">Selecionar</button>
                    <button class="btn edit" onclick="abrirPergaminho({{ cart.id }})">Ver Itens</button>
                <form action="{{ url_for('delete_cart', cart_id=cart.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn delete" onclick="return confirm('Tem certeza que deseja deletar este carrinho?')">
                        Deletar
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Modal do Pergaminho -->
    <div id="pergaminho-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999;"></div>
    <div id="pergaminho-modal">
        <button id="fechar-pergaminho">✖</button>
        <h3>Itens do Carrinho</h3>
        <ul id="lista-itens-modal"></ul>
    </div>

    <audio id="som-pergaminho" src="{{ url_for('static', filename='scroll-open.mp3') }}"></audio>
    <div id="manage-container"></div>

    <!-- Flash messages elegantes -->
    <div id="flash-container" class="flash-container"></div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      const flashContainer = document.getElementById('flash-container');
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
          if (flashContainer && "{{ message|e }}".trim()) {
            flashContainer.className = 'flash-container flash-' + ('{{ category }}' === 'error' ? 'error' : 'success');
            flashContainer.innerHTML = `<span class="flash-icon"></span> {{ message|e }}`;
            setTimeout(() => flashContainer.classList.add('show'), 100);
            setTimeout(() => {
              flashContainer.classList.remove('show');
              setTimeout(() => flashContainer.innerHTML = '', 300);
            }, 4000);
          }
        {% endfor %}
      {% endwith %}
    });
    </script>
{% endblock %}